# [ラーニング パス 3 - ラボ 3 - 演習 2 - ID 同期の実装](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#learning-path-3---lab-3---exercise-2---implement-identity-synchronization)

この演習では、Azure AD Connect を使用して、Adatum のオンプレミス Active Directory と Azure Active Directory 間の同期を有効にします。その後、Azure AD Connect は 30 分ごとにデルタ変更を同期し続けます。次に、ユーザーとグループの更新をいくつか行ってから、Azure AD Connect が自動的に更新を同期するのを待つのではなく、手動で強制的に即時同期を実行します。次に、更新が同期されたかどうかを確認します。

重要**:**この演習を開始するときは、Azure AD Connect が ID オブジェクトに加えた変更を自動的に同期しないように、最初の 4 つのタスクを遅延なく実行する必要があります。

### [タスク 1: Azure AD Connect をインストールし、同期を開始する](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#task-1-install-azure-ad-connect-and-initiate-synchronization)

このタスクでは、Azure AD Connect セットアップ ウィザードを実行して、Adatum のオンプレミス Active Directory と Azure Active Directory 間の同期を有効にします。構成が完了すると、同期プロセスが自動的に開始されます。

1. 前のタスクのローカル**adatum\administratorとして****LON-DC1**にログインしている必要があります。

2. 前のラボ演習を終了した後も、Edge ブラウザーで Holly Dickson として Microsoft 365 にログインしているはずです。

3. **Edge**ブラウザーで、**[Microsoft 365 管理センター]**タブを選択し、ナビゲーション ウィンドウで [**ユーザー]**、**[アクティブ ユーザー]**の順に選択します。

4. **[アクティブ ユーザー]**ウィンドウで、メニュー バーの最後に表示される**省略記号アイコンを選択し、表示されるドロップダウン メニューで****[ディレクトリ同期]**を選択します。これにより、**Azure AD へのユーザーの追加または同期ウィザード**が開始されます。

5. **Azure AD にユーザーを追加または同期する**ウィザードの [**ユーザー同期について]**ページで、内容を最後までお読みください。**[ユーザー ステータス]**セクションで、既存の Adatum クラウド ユーザーとハイブリッド ユーザーの数に注目してください。**「次へ」**を選択します。

6. **[移行オプションの選択]**ページで各オプションの説明を読み、使用可能な移行オプションを理解します。**[継続的同期]**オプションを選択し、 **[次へ]**を選択します。

7. **「IdFix を実行して準備」**ページでは、前のラボ演習で IdFix をすでに実行しているため、再度ダウンロードして実行する必要はありません。**「次へ」**を選択します。

8. **[同期ツールの確認]**ページで、Holly は当初、 Adatum の Exchange ハイブリッド デプロイを考慮して**Azure AD Connect**オプションを選択する予定でした。ただし、これが正しい解決策であることを確認するためだけに、Holly は、同期要件に基づいて使用する同期ツールを推奨するシステム ツールを使用することにしました。Holly は、この機能を使用して、Azure AD Connect が Adatum にとって正しい選択であるかどうかを確認します。

   **[決定を手伝ってください**] を選択します。このオプションを使用すると、組織が持つ可能性のあるさまざまな要件の中から選択できます。

9. 表示される要件のリストで、次の Adatum 要件を選択して、システムが推奨する同期ツールを確認します (追加の要件をそれぞれ選択すると、推奨がどのように変化するかに注目してください)。

   - **[ユーザーが同じパスワードを使用してオンプレミスとクラウドベースのアプリケーションの両方にアクセスできる機能 (パスワード ハッシュ同期とパスワード ライトバック) が必要です] を選択します**。

     **注:**このチェック ボックスをオンにすると、ページの下部に表示される推奨事項に注意してください。この 1 つの要件を選択するだけで、システムは**Azure AD クラウド同期の**使用を推奨します。

   - **クラウドと同期する必要がある Exchange オンプレミス オブジェクトがあります (Exchange ハイブリッド) を**選択します。

     **注:この 2 番目のチェック ボックスを選択すると、推奨事項が****Azure AD Connect**に変わります。これにより、Azure AD Connect を選択するという Holly の最初の考えが、Adatum の同期要件を考慮してシステムが推奨したものと同じであったことが確認されます。

10. **「次へ」**を選択します。システムは、推奨ソリューションである**Azure AD Connect**を使用して同期を開始します。

11. **[ユーザーの同期]**ページで、 **[Azure AD Connect のダウンロード]**ボックスを選択します。これにより、ブラウザーで新しいタブが開き、Microsoft ダウンロード センターに移動します。

12. **Microsoft ダウンロード センター**に、 **「Microsoft Azure Active Directory Connect をダウンロードしていただきありがとうございます」**というメッセージが表示されます。

    画面の上部に**[ダウンロード]**ウィンドウが表示される場合は、ダウンロードが完了した**AzureADConnect.msi**ファイルの下に表示される [**ファイルを開く]リンクを選択します。**

    ただし、**ダウンロード**ウィンドウが画面の上部に表示されない場合は、プロファイル**1**アイコン (円の中の人の画像) の右側に表示される省略記号アイコン (3 つの点) を選択します。表示されるドロップダウン メニューで、**[ダウンロード]**を選択します。画面の上部に**[ダウンロード]ウィンドウが表示され、そのウィンドウに****AzureADConnect.msi**ファイルが含まれている場合は、その下に表示される [**ファイルを開く]**リンクを選択します。ただし、**AzureADConnect.msi が****[ダウンロード]**ウィンドウ に表示されない場合は、 **Microsoft ダウンロード センター**ページで、[**ここをクリックして手動でダウンロード] を選択します。**ハイパーリンクをクリックし、この手順を繰り返して**AzureADConnect.msi**ファイルを開きます。

13. **AzureADConnect.msi**ファイルを開くと、 Microsoft Azure Active Directory Connect ウィザードが開始され、 **Microsoft Azure Active Directory Connect**ツールのインストールが開始されます。ウィザードの最初のページが表示されてから突然消える場合や、まったく表示されない場合があります。いずれかの状況が発生した場合は、タスクバーのウィザード アイコンを選択します。

14. セットアップ ウィザードの**[Azure AD Connect へようこそ]**ウィンドウで、 **[ライセンス条項とプライバシー通知に同意します]**チェック ボックスをオンにし、 [**続行]**を選択します。

15. **[高速設定]**ページで、単一の Windows Server AD フォレストに関する手順を読み、[**高速設定を使用する]**を選択します。

16. **[Azure AD に接続]**ウィンドウで、**[USERNAME]フィールドに****[Holly@xxxxxZZZZZZ.onmicrosoft.com](mailto:Holly@xxxxxZZZZZZ.onmicrosoft.com)** (xxxxxZZZZZZ はラボ ホスティング プロバイダーによって提供されるテナント プレフィックス) を入力します。

    **[PASSWORD]**フィールドに、ラボ ホスティング プロバイダーからテナント管理者アカウント (MOD 管理者アカウント) 用に提供されたのと同じ**Microsoft 365 テナント パスワード**を入力し、 [**次へ]**を選択します。

    **注:** **[次へ]**ボタンが有効になっていない場合は、 **[パスワード]**フィールドをタブで外して有効にします。

17. **[AD DS に接続]**ページで、[ **USERNAME]**フィールドに**「adatum\Administrator」**と入力し、[ **PASSWORD]**フィールドに**「Pa55w.rd** **」**と入力して、[次へ] を選択します ([**次へ**] ボタンが有効になっていない場合は、[パスワード] フィールドをタブで外して有効にします)。

18. **Azure AD サインイン構成**ウィンドウで、ページの下部にある [**すべての UPN サフィックスを検証済みのドメインに一致させずに続行する] チェック ボックスをオンにし、** **[次へ]**を選択します。

19. **[構成の準備完了]**画面で、 **[構成の完了時に同期プロセスを開始する]**チェック ボックスがまだ選択されていない場合は選択し、 [**インストール]**を選択します。

    **重要:** Holly は最終的に Exchange ハイブリッド展開をインストールする予定ですが、今はインストールする予定はありません。このラボでは、**Exchange ハイブリッド展開**オプションを選択**しない**でください。

20. 構成が完了するまで待ちます (数分かかる場合があります)。**[構成の完了]**ページで、**[終了]**を選択します。

21. タスクバーの左下隅にある**Windows (スタート)**アイコンを選択します。**表示される[スタート]**メニューで、アイコンを選択してすべてのアプリを表示します。**[Azure AD Connect]**を選択してグループを展開し、**[同期サービス]**を選択してこのデスクトップ アプリケーションを開始します。

    **注:** **[スタート]**メニューで**[Azure AD Connect]**を選択し、それが展開されて**[同期サービス]**を選択できた場合は、次のステップ (ステップ 22) に進みます。ただし、**[スタート]メニューで****Azure AD Connect を**選択したときに展開されなかった場合は、すべてのアプリケーションを閉じて、LON-DC1 を再起動する必要があります。

    **注:**この手順の残りの手順は、LON-DC1 を再起動する必要がある場合に実行する必要がある手順です。

    LON-DC1 を再起動した場合は、再起動後に、ラボ ホスティング プロバイダーの指示に従って**Ctrl+Alt+Delete**を選択します。LON-DC1 のログオン画面が表示されます。

    **Adatum\Administrator**としてパスワード**Pa55w.rd**でログインします。

    **サーバー マネージャーが**開いたら最小化し、**Edgeブラウザを開いて****htps://portal.office.com**に移動します。

    **[Holly@xxxxxZZZZZZ.onmicrosoft.com](mailto:Holly@xxxxxZZZZZZ.onmicrosoft.com)**としてログインします。**[パスワード]**フィールドに、ラボ ホスティング プロバイダーからテナント管理者アカウント (つまり、MOD 管理者アカウント) 用に提供されたのと同じ**Microsoft 365 テナント パスワードを入力します。**

    **Microsoft Office ホーム**ページで、**[管理者]を選択して****Microsoft 365 管理センター**を開きます。

    次に、タスクバーの左下隅にある**Windows (スタート)アイコンを選択します。****表示される[スタート]**メニューで、**[Azure AD Connect]**を選択してグループを展開し (今回は展開する必要があります)、 [**同期サービス]**を選択します。

22. **LON-DC1 ウィンドウで Synchronization Service Manager を**最大化します。画面上部の [操作] タブがデフォルトで表示され、このプログラムを選択すると自動的に開始される同期プロセスを監視でき**ます**。

23. **xxxxxZZZZZZ.onmicrosoft.com-AADの****エクスポート**プロファイルが完了するまで待ちます。完了すると、**ステータスは****completed-export-errors**になるはずです。完了してこのステータスが表示されたら、この行を選択します。

24. 画面の下部に、選択した操作の詳細情報を示す詳細ペインが表示されます。

    - 左側の [**統計のエクスポート]**ウィンドウで、Azure Active Directory に追加されたオンプレミス ユーザーの数と更新された数をメモします。

    - 右側の**[エクスポート エラー]**ペインで、表示されるエラーに注目してください。前回のラボ演習で IdFix ツールを実行したときを思い出してください。意図的に修正しなかった検証エラーが発生したユーザーが 2 人いました ( **Ngoc Bich Tran**と**An Dung Dao** )。

      **最初のDataValidationFailed**エラーに該当する**[エクスポート エラー]**列の下の最初のリンク (CN={xxxxxx...) を選択します。これにより、Azure AD Connect ツールによって同期されなかった 2 人のユーザーのうち最初のユーザーが表示されます。エラーを確認して、このアカウントが壊れている理由を確認してください。**ヒント:** **[コネクタ スペース オブジェクトのプロパティ]**ウィンドウで、**[エクスポート エラー]**タブを選択します。**「エラー情報」**セクションで、**「詳細」**ボタンを選択します。詳細なエラー情報を確認し、**[閉じる]**を選択します。もう一度**「閉じる」**を選択します。

      2 番目のデータ検証エラー リンクを選択し、このエラーが意図的に修正しなかった 2 番目のユーザーのものであることを確認します。前と同じ手順に従って、このユーザーのエラーを確認します。

    重要**:**これより前に同期が実行されていなかったため、最初の同期は**完全同期**でした(上部ペインの**プロファイル名列を参照)。****同期プロセスは 30 分ごとに自動的に実行され続けるため、後続の同期ではプロファイル名**として**デルタ同期**が表示されます。**Synchronization Service Manager**ウィンドウを開いたままにすると、30 分後に、初期同期中に同期されなかった 2 人のユーザーの同期が試行されることがわかります。**これらは、完全同期**ではなく**デルタ同期**として表示されます。

25. Azure AD Connect が完全同期を完了したことが確認できたので、次のタスクでは、いくつかの更新を行って、30 分ごとに更新が同期されるのを待つのではなく、手動で強制的に即時同期を実行します。**LON-DC1 の Synchronization Service Manager**ウィンドウを閉じます。

26. ブラウザで、**[ホーム] | [タブ]を除くすべてのタブを閉じます。[Microsoft 365]**タブと**[アクティブなユーザー - Microsoft 365 管理センター]**タブ。

27. LON-DC1 は次の演習で使用するため、開いたままにしておきます。

### [タスク 2 - 同期をテストするためのグループ アカウントを作成する](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#task-2---create-group-accounts-to-test-synchronization)

手動の強制同期プロセスをテストするには、いくつかのグループ シナリオをセットアップして、強制同期機能が Azure AD Connect で機能しているかどうかを確認します。新しいセキュリティ グループを作成し、既存の組み込みセキュリティ グループのグループ メンバーをすべて Adatum のオンプレミス環境内で更新します。

各グループには複数のメンバーが割り当てられます。強制同期後、Microsoft 365 の各セキュリティ グループが表示され、そのメンバーがオンプレミス グループからクラウド グループに同期されたことを検証します。また、Adatum のオンプレミス環境でメンバーを追加した場合でも、組み込みセキュリティ グループが Microsoft 365 で作成されていないことも検証します。

**重要:**組み込みグループは、「**Active Directory ユーザーとコンピューター」の****組み込み**コンテナーの下にある、事前定義されたオンプレミスのセキュリティ グループです。これらは、Active Directory ドメインの作成時に自動的に作成されます。これらのグループを使用して、共有リソースへのアクセスを制御し、特定のドメイン全体の管理役割を委任できます。**ただし、メンバーを追加した後でも、Microsoft 365 には同期されません。**このタスクでは、この機能を検証します。

1. 前のタスクで**管理者**として**LON-DC1**にログインしたままである必要があります。

2. **サーバー マネージャーが**閉じている場合は、ここで再度開きます。それ以外の場合は、タスクバーの**サーバー マネージャーアイコンを選択します。**

3. **サーバー マネージャー**で、画面右上の [**ツール]を選択し、ドロップダウン メニューで****[Active Directory ユーザーとコンピューター] を選択します。**

4. まず、組み込みのオンプレミス セキュリティ グループの 1 つにメンバーを追加します。**「Active Directory ユーザーとコンピュータ」**ウィンドウを最大化します。左側のペインのコンソール ツリーで、**Adatum.comの下にある****Builtin**フォルダーを選択します。**これにより、 Adatum.com**ドメインの作成時に自動的に作成されたすべての組み込みセキュリティ グループ フォルダーが表示されます。

5. 右側の詳細ペインで、**Print Operators**セキュリティ グループをダブルクリックします。

6. **「印刷オペレーターのプロパティ」**ウィンドウで、**「メンバー」タブを選択し、** **「追加」**ボタンを選択します。

7. **[ユーザー、連絡先、コンピュータ、サービス アカウント、またはグループの**選択] ウィンドウの**[選択するオブジェクト名を入力してください] フィールド**に次の名前を入力します (セミコロンで区切って 3 つすべてを一度に入力します)。

   - **アシュリー・ピケット**
   - **ファニータ・クック**
   - **モーガン・ブルックス**

8. **[名前の確認]**を選択します。すべての検証が完了したら、**「OK」を選択して****「印刷オペレーターのプロパティ」**ウィンドウに戻ります。

9. **[Print Operators Properties]**ウィンドウで**[OK]**を選択して、**[Active Directory ユーザーとコンピュータ]**ウィンドウに戻ります。

10. ここで、新しいセキュリティ グループを作成します。**Adatum.com**の下のコンソール ツリーで、 **Research**フォルダーを右クリックし、**[新規]を選択し、** **[グループ]**を選択します。

11. **[新しいオブジェクト - グループ]**ウィンドウで、次の情報を入力します。

    - グループ名:**製造業**
    - グループ範囲:**ユニバーサル**
    - グループの種類:**セキュリティ**

12. **[OK]**を選択します。

13. **Adatum.com**の下のコンソール ツリーで**Research**フォルダーを選択し、右側の詳細ペインで**Manufacturing**セキュリティ グループをダブルクリックします。

14. **「製造プロパティ」**ウィンドウで、**「電子メール」**フィールドに**[「Manufacturing@adatum.com」](mailto:manufacturing@adatum.com)**と入力します。

    **注:** Microsoft 365 には、セキュリティ グループとメールが有効なセキュリティ グループという 2 種類のセキュリティ グループがあります。このオンプレミス セキュリティ グループの [**電子メール]**フィールドに値を入力すると、同期プロセスによって Microsoft 365 にメールが有効なセキュリティ グループが作成されます。

15. **[メンバー]**タブを選択し、手順 6 ～ 9 を繰り返して、次のメンバーをこのグループに追加します。

    - **ベルナルド・ルッター**
    - **チャーリー・ミラー**
    - **ドーン・ウィリアムソン**

16. 次のタスクのために**[Active Directory ユーザーとコンピュータ]**ウィンドウを開いたままにしておきます。

### [タスク 3 - 同期をテストするためにグループ メンバーシップを変更する](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#task-3---change-group-membership-to-test-synchronization)

このタスクでは、同期プロセスが Azure AD Connect で機能しているかどうかをテストするための別のシナリオを設定します。このタスクでは、グループのメンバーを変更して、グループが同期された後にそのメンバーがクラウドに反映されるかどうかを確認します。

1. このタスクは、LON-DC1 で前のタスクが中断したところから継続します。**[Active Directory ユーザーとコンピュータ]**ウィンドウの**Adatum.com**の下のコンソール ツリーでは、**Research**組織単位が選択されたままです。

   右側の詳細ペインで、**Research**セキュリティ グループをダブルクリックします。

2. **[リサーチ プロパティ]**ウィンドウで、**[メンバー]**タブを選択して、このグループのメンバーを表示します。

3. 次のユーザーをグループから削除したいと考えています:

   - **カイチュー**
   - **シャノンブース**
   - **ティア・ゼシレビッチ**

   **ヒント:**各ユーザーを個別に削除することもできますが、最も簡単な方法は、3 人全員を一度に削除することです。最初のユーザーを選択し、**Ctrl**キーを押したまま下にスクロールして、他の 2 人を選択します。3 人のユーザーをすべて選択した状態で、**[削除]ボタンを選択し、** **[はい]**を選択して削除を確認します。3 人のユーザーが削除されたことを確認し、**[OK] を選択します。**

4. **「Active Directory ユーザーとコンピュータ」**ウィンドウを閉じます。

5. 次のタスクで引き続き使用するため、LON-DC1 は開いたままにしておきます。

   重要**:**前のタスクで ID オブジェクトに加えた変更が Azure AD Connect によって自動的に同期されないように、このタスクを完了したらすぐに次のタスクを実行する必要があります。

### [タスク 4 - 手動同期を強制する](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#task-4---force-a-manual-synchronization)

このタスクでは、Azure AD Connect が ID オブジェクトを同期するまで 30 分待つ代わりに、Adatum のオンプレミス AD と Azure AD の間の同期を強制します。強制同期を実行するには、PowerShell を使用する必要があります。

**重要 - PowerShell に関する注意:**前のラボ演習では、その演習のタスクで Microsoft Graph PowerShell ではなく MSOnline モジュールを使用した理由を示す免責事項が提供されていました。Microsoft は、MSOnline と Azure Active Directory (Azure AD) PowerShell の 2 つの古い PowerShell モジュールを Microsoft Graph PowerShell に置き換える作業を進めていますが、古いモジュールには Microsoft Graph PowerShell にまだ組み込まれていない機能がいくつかあります。前の演習のコマンドとこのタスクで使用したコマンドは、このカテゴリに分類されます。前の演習では MSOnline モジュールに接続しましたが、このモジュールも Start-ADSyncSyncCycle コマンドに従ってこのタスクで使用されます。

1. LON-DC1 で、前の演習で**Windows PowerShellアプリケーションがまだ開いている場合は、****ここで閉じる必要があります**。

   警告**:**この手順を実行する理由は、Azure AD Connect のセットアップ前に Windows PowerShell を開いた場合、手順 3 で使用したコマンドレット**Start-ADSyncSyncCycle**が使用できなくなり、コマンドレットが認識されないことを示すエラーが表示されるためです。実行しようとすると。したがって、このステップでは、Windows PowerShell が開いている場合は閉じることをお勧めします。

2. この時点では、Windows PowerShell は開いてはいけません。今、それを再度開きたいと考えています。これを開くには、タスク バーの**虫眼鏡 (検索)アイコンを選択し、検索ボックスに****「power」**と入力し、メニューで**Windows PowerShell** (Windows PowerShell ISE ではない) を右クリックし、**[管理者として実行]**を選択します。Windows PowerShell ウィンドウが開いたら、最大化します。

3. **Windows PowerShell**で次のコマンドを実行して、Adatum のオンプレミス AD と Azure AD の間で同期サイクルを手動で実行します。ここではデルタスイッチを使用して、更新のみが同期されるようにします **。**

   ```
    Start-ADSyncSyncCycle -PolicyType Delta
   ```

   

   注**:**何らかの理由で、最初の完全同期の実行後にドメイン コントローラー VM が再起動された場合、Microsoft Azure AD Sync サービスが再起動していない可能性があります。この問題が発生した場合、上記の強制同期を実行しようとするとエラーが発生します。この問題が発生した場合は、まず Microsoft Azure AD Sync サービスを開始してから、強制同期を実行する必要があります。

   **注:** Start-ADSyncSyncCycle コマンドが見つからない場合は、PowerShell モジュールのインストールを完了するためにドメイン コントローラーを再起動する必要があります。

4. 同期プロセスが正常に完了したら、PowerShell ウィンドウを最小化し (閉じないでください)、次のタスクに進みます。次のタスクでは PowerShell を使用して、ディレクトリ同期の結果の一部を検証します。

5. LON-DC1 に留まり、次のタスクに進みます。

### [タスク 5 - ディレクトリ同期の結果を検証する](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#task-5---validate-the-results-of-directory-synchronization)

このタスクでは、以前に行った変更が Adatum のオンプレミス Active Directory から Azure Active Directory に同期されたかどうかを検証します。Microsoft 365 管理センターを使用して変更を検証し、次に Windows PowerShell を使用して同じ検証を実行します。これにより、Microsoft 365 管理センター GUI と PowerShell の両方を使用して同期を検証する経験が得られます。

**重要 - PowerShell に関する注意:**このタスクでは、Microsoft Graph PowerShell でサポートされている、グループとユーザーに対する基本的な PowerShell クエリを使用します。Microsoft Graph PowerShell は、MSOnline と Azure Active Directory (Azure AD) PowerShell という 2 つの古い PowerShell モジュールを置き換えるものであるため、このタスクでは Microsoft Graph PowerShell を使用します。

1. ローカルの**adatum\administrator**としてパスワード**Pa55w.rd を使用して LON-DC1 にログインしている必要があります。**

2. 次に、前のタスクで更新したグループの同期結果を調べてみましょう。**Edge**ブラウザで、[**ホーム] | [ホーム]**のタブがまだ開いている場合は、**Microsoft 365**ページと**[アクティブなユーザー - Microsoft 365 管理センター] に移動**し、次の手順に進みます。

   それ以外の場合は、アドレス バーに**https://portal.office.com/****と入力してMicrosoft 365 ホームページを開き、** **[holly@xxxxxZZZZZZ.onmicrosoft.com](mailto:holly@xxxxxZZZZZZ.onmicrosoft.com)**としてログインします(xxxxxZZZZZZ は、ラボ ホスティング プロバイダーによって提供されるテナント プレフィックスです) ）。**[パスワード]**フィールドに、ラボ ホスティング プロバイダーからテナント管理者アカウント (MOD 管理者アカウント) 用に提供されたものと同じ**Microsoft 365 テナント パスワードを入力し、** **Microsoft 365 ホームページで****Microsoft 365 管理センター**に移動します。

3. **Microsoft 365 管理センター**のナビゲーション ウィンドウで**[チームとグループ]**を選択し、 [**アクティブなチームとグループ]**を選択します。

4. **[アクティブなチームとグループ]**ウィンドウには、既定で**[Microsoft 365]**タブが表示されます。**「セキュリティ」**タブを選択します。**Print Operators**グループがセキュリティ グループのリストに表示されないことを確認します。**前述したように、 Print Operators**グループなどの組み込みセキュリティ グループは、前のタスクで行ったようにグループにメンバーを追加した場合でも、オンプレミス AD から Azure AD に同期されません。

5. **[メールが有効なセキュリティ]**タブを選択します。**[製造]**グループが表示されることを確認します。前のタスクでオンプレミス グループに 電子メール アドレス ( **[production@adatum.com](mailto:manufacturing@adatum.com)** )を追加したため、このグループは標準のセキュリティ グループではなく、メールが有効なセキュリティ グループとして表示されます。

   **注:** **[製造]**グループが表示されるまで、最大 10 分間待つ必要がある場合があります。グループが表示されるまでリストを更新し続けます。

6. **製造**グループの場合は、 **[電子メール]**列に表示される値を確認します。**[ディレクトリ同期中にグループの電子メール アドレスが、 Manufacturing@adatum.com](mailto:manufacturing@adatum.com)**から、Exchange Online のグループのメールボックスである**[Manufacturing@xxxxxZZZZZZ.onmicrosoft.com](mailto:manufacturing@xxxxxZZZZZZ.onmicrosoft.com)**に変更されたことを確認します。

   **[同期ステータス]**列のアイコンの上にマウスを置き、 **[オンプレミスから同期済み]**と表示されていることを確認します。

7. **[製造]**グループの右側には、垂直の省略記号アイコン (ピリオドが 3 つ垂直に並んでいます) があります。このアイコンの上にマウスを置きます。このグループはオンプレミス環境でのみ管理できることを示すメッセージが表示されることに注意してください。

8. 次に、Windows PowerShell を使用してこのグループを調べてみましょう。**Windows PowerShell**がタスクバーですでに開いている場合は、PowerShell アイコンを選択して次の手順に進みます。それ以外の場合は、タスク バーの**[検索]**フィールドに**「PowerShell」と入力し、** **Windows PowerShell**アプリケーションを右クリックして [**管理者として実行]**を選択します。PowerShell ウィンドウを最大化します。

9. まず、Microsoft Graph PowerShell をインストールする必要があります。このトレーニングの前半で、Microsoft Graph PowerShell を LON-CL1 にインストールしました。その時点で、次のコマンドを実行して 30 個以上のサブモジュールをすべてインストールしました: Install-Module Microsoft.Graph (Graph は 30 個以上のサブモジュールを含む親モジュールです)。30 以上のサブモジュールをすべて LON-DC1 にインストールすることもできますが、このタスクではグループとユーザーのサブモジュールのみを使用します。これは、LON-DC1 で PowerShell を使用するこのトレーニングの最後のタスクです。したがって、インストール時間を短縮するには、次の 2 つのコマンドを実行します。これにより、これら 2 つのサブモジュールのみがインストールされ、他の 30 以上のサブモジュールはインストールされません。これにより、Graph サブモジュール全体ではなく、特定のサブモジュールをインストールする経験も得られます。

   ａ．**次のコマンドを入力して Enter キーを押します (信頼できないリポジトリからこのモジュールをインストールするかどうかを尋ねるメッセージが表示された場合は、 「すべてはい」**の意味で**A**を入力します。次のコマンドでも同じことを行います)。

   ```
    Install-Module Microsoft.Graph.Groups -Scope CurrentUser  <br/>
   ```

   

   b. コマンド プロンプトで次のコマンドを入力し、Enter キーを押します。

   ```
    Install-Module Microsoft.Graph.Users -Scope CurrentUser  <br/>
   ```

   

10. Groups サブモジュールと Users サブモジュールをインストールしたので、それぞれのコマンドレットを PowerShell セッションにインポートするには、それぞれをインポートする必要があります。これを行うには、次の 2 つのコマンドを実行する必要があります。

    ａ．次のコマンドを入力して Enter キーを押します。

    ```
    Import-Module Microsoft.Graph.Groups
    ```

    

    ａ．次に、次のコマンドを入力して Enter キーを押します。

    ```
    Import-Module Microsoft.Graph.Users
    ```

    

11. コマンド プロンプトで、Microsoft Graph に接続し、インポートしたばかりの Groups および Users コマンドレットを使用する許可の要求を実行する必要があります。このタスクを完了するには、これら 2 つのサブモジュールに対する「読み取り専用」権限のみが必要です。次のコマンドを入力して Enter キーを押します。

    ```
    Connect-MgGraph -Scopes 'Group.Read.All', 'User.Read.All'
    ```

    

12. **表示される「アカウントを選択」**ウィンドウで、**Holly Dickson の**アカウントを選択します。**[パスワードの入力]**ウィンドウで、ラボ ホスティング プロバイダーから提供されたのと同じ**Microsoft 365 テナント パスワードを**テナント管理者アカウント (つまり、MOD 管理者アカウント) に入力し、 [**サインイン]**を選択します。

13. **[アクセス許可が要求されました**] ダイアログ ボックスが表示された場合は、 **[組織を代表して同意する**] チェック ボックスをオンにして、**[同意する]**を選択します。

14. ここで、PowerShell を使用して、Microsoft 365 のグループのリストを表示します。このリストには、Microsoft 365 で手動で作成したグループと、Microsoft と同期したばかりのオンプレミスの Active Directory で作成されたグループが含まれている必要があります。 365. 次のコマンドを入力し、Enter キーを押します。

    ```
    Get-MgGroup | Format-List Id, DisplayName, Description, GroupTypes
    ```

    

15. **次に、リサーチ**グループのメンバーを表示したいとします。グループのリストで、**リサーチグループのオブジェクト ID を強調表示し、** **Ctrl+C**を押してID をクリップボードにコピーします。次に、次のコマンドを入力し、リサーチ グループのオブジェクト ID ( **Ctrl+V** ) を適切な場所に貼り付けて、Enter キーを押します。

    ```
    Get-MgGroupMember -GroupId 'paste in the group's object ID here'
    ```

    

16. 前の手順で表示されたグループ メンバーのリストでは、結果に各メンバーのオブジェクト ID が単純に表示されることに注目してください。ユーザー名を表示しない場合、このコマンドはグループ メンバーが同期されているかどうかを確認するのには役立ちません。この問題を回避するには、前のコマンドを繰り返しますが、今回はグループの各メンバーのユーザー レコードを取得し、ユーザー名を含むユーザーの属性を表示するコンポーネントを追加します。

    コマンド プロンプトでキーボードの上矢印を押します。これにより、以前に実行されたコマンドが自動的に入力されます (これにはリサーチ グループのオブジェクト ID が含まれるため、再貼り付ける必要はありません)。次に、オブジェクト ID に続いて、コマンドの残りの部分 ( **-All**で始まる) を入力し、Enter キーを押します。

    ```
    Get-MgGroupMember -GroupId 'the object ID of the Research group' -All | ForEach {Get-MgUser -UserId $_.Id}
    ```

    

17. Research グループのメンバーのリストに、次のユーザーが含まれて**いない**ことを確認します。前のタスクで、グループを Microsoft 365 に同期する前に、オンプレミスの Active Directory のリサーチ グループからこれら 3 人のユーザーを削除したことを思い出してください。

    - カイチュー
    - シャノンブース
    - タイ・ゼシレビッチ

18. 前のタスクでは、オンプレミスの Active Directory に**製造**グループを追加し、そのグループに 3 人のユーザーを割り当てました。ここで、同期プロセス中に Microsoft 365 にグループが追加されたときに、**製造**グループのメンバーが同期されたことを確認したいと考えています。

    **これを行うには、まずグループのリストまでスクロールして戻り、マニュファクチャリング**グループのオブジェクト ID を強調表示してから、**Ctrl+C**を押してID をクリップボードにコピーする必要があります。

    次に、キーボードの上矢印を押して、前のコマンドを自動的に入力します。このコマンドには、前の手順で貼り付けたリサーチ グループのオブジェクト ID が含まれています。

    ```
    Get-MgGroupMember -GroupId 'the object ID of the Research group' -All | ForEach {Get-MgUser -UserId $_.Id}    <br/>
    ```

    

    **重要:**このコマンドを実行する前に、Research グループのオブジェクト ID を Manufacturing グループのオブジェクト ID に置き換える必要があります。これを行うには、キーボードの左矢印を使用してカーソルをオブジェクト ID の先頭に移動し、リサーチ グループのオブジェクト ID を強調表示して**Ctrl+V**を押します。これにより、研究グループの ID が**製造**グループのオブジェクト ID に貼り付けられて置き換えられます。次に、Enter キーを押してコマンドを実行します。**これにより、製造**グループのメンバーが表示されます。

    **製造**グループでは、以前に次のメンバーをオンプレミスの Active Directory のグループに追加しました。同期後、この Microsoft 365 グループにこれらの各グループ メンバーが表示されるようになります。

    - ベルナルド・ルッター
    - チャーリー・ミラー
    - ドーン・ウィリアムソン

19. これで、テスト グループとユーザー アカウントが適切に同期されたことが検証されました。検証手順が完了したら、PowerShell ウィンドウを閉じます。

# [ラボ 3 - 演習 3 に進みます。](https://github.com/ctct-edu/ms-102-lab/blob/main/Instructions/Labs/LAB_AK_03_Lab3_Ex2_Implement_Identity_Synch.md#proceed-to-lab-3---exercise-3)
