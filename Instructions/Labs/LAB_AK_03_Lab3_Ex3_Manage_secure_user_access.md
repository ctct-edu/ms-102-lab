# [ラーニング パス 3 - ラボ 3 - 演習 3 - 安全なユーザー アクセスの管理](https://github.com/MicrosoftLearning/MS-102T00-Microsoft-365-Administrator-Essentials/blob/master/Instructions/Labs/LAB_AK_03_Lab3_Ex3_Manage_secure_user_access.md#learning-path-3---lab-3---exercise-3---manage-secure-user-access)

Adatum の Microsoft 365 管理者である Holly Dickson は、Adatum の CTO から、組織全体のパスワード管理を強化する手段としてパススルー認証 (PTA) と Azure AD スマート ロックアウトを展開するように依頼されました。

### [タスク 1: Azure AD パススルー認証を展開する](https://github.com/MicrosoftLearning/MS-102T00-Microsoft-365-Administrator-Essentials/blob/master/Instructions/Labs/LAB_AK_03_Lab3_Ex3_Manage_secure_user_access.md#task-1-deploy-azure-ad-pass-through-authentication)

パススルー認証を使用すると、ユーザーはオンプレミスのパスワードを使用してクラウドベースのサービスにサインインできます。すべてのユーザー パスワードはオンプレミス ドメインにローカルにのみ保存され、クラウドに同期されることはありません。ユーザーがサインインすると、PTA エージェントは資格情報をユーザーのオンプレミス環境に取り込み、パスワードが正しいかどうかを確認します。次に、結果を Azure AD に送り返します。

Adatum の CTO は、同社のユーザーにより良いサインイン エクスペリエンスを提供したいと考えています (PTA では覚えておくべきパスワードが 1 つ少なくて済むため)。また、PTA を使用するとユーザーがサインイン方法を忘れる可能性が低くなるため、Adatum の IT ヘルプデスクのコストを削減したいと考えています。これは、パスワード ハッシュ同期や Active Directory フェデレーション サービスを採用することによっても実現できますが、Adatum は Microsoft 365 パイロット プロジェクトで PTA をテストすることを選択しました。

1. 前のタスクのローカル**adatum\administratorとして****LON-DC1**にログインしている必要があります。
2. LON-DC1 では、タスクバーの**[スタート]ボタンを選択し、** **[スタート]メニューで****[すべてのアプリ]**アイコンを選択して、インストールされているすべてのアプリケーションのリストを表示します。**Azure AD Connect**プログラム グループを選択し、 **[Azure AD Connect]**を選択します。これにより、**Microsoft Azure Active Directory Connect**ウィザードが開始されます。
3. **[Azure AD Connect へようこそ]**ウィンドウに、このセットアップ ウィザードが閉じるまで同期サービス スケジューラーが一時停止されていることを示すページが表示されます。これは、Azure AD Connect インストール ウィザードを開始すると (前のタスクで実行しました)、スケジューラが一時的に停止されるためです。「構成」を選択します**。**
4. **[追加タスク]**ページで、**[ユーザー サインインの変更]**タスクを選択し、**[次へ]**を選択します。
5. **[Azure AD に接続]**ページで、Azure AD にサインインします。USERNAMEフィールドには**、**すでに**[Holly@xxxUPNxxx.onmicrosoft.com](mailto:Holly@xxxUPNxxx.onmicrosoft.com)**が入力されています。**[PASSWORD]**フィールドに、ラボ ホスティング プロバイダーからテナント管理者アカウント (MOD 管理者アカウント) 用に提供されたのと同じ**Microsoft 365 テナント パスワード**を入力し、 [**次へ]**を選択します。
6. **[ユーザー サインイン]**ページの [サインオン方法の選択] で、[**パススルー****認証]**を選択し、**[次へ]**を選択します。
7. **[シングル サインオンの有効化]**ページで、**[資格情報の入力]**を選択します。
8. **[フォレスト資格情報]**ダイアログ ボックスで、**ユーザー名**として**adatum\administrator を**入力し、**パスワード**として**Pa55w.rd を**入力し、**[OK]**を選択します。
9. **資格情報が検証されると、 [資格情報の入力]**ボタンの右側にチェック マークが表示されます。**「次へ」**を選択します。
10. **[構成の準備完了]**ページで、**[構成]**を選択します。構成が完了するまでに 1 分ほどかかる場合があります。
11. **[構成の完了]**ページで、Azure AD の現在のサインオン方法が PTA であることを示すメッセージに注目してください。**[終了]**を選択します。これでパススルー認証が有効になりました。
12. パススルー認証が正常に有効になっていることを確認するには、Edge ブラウザで新しいタブを選択し、アドレス バーに次の URL を入力します: **[https://entra.microsoft.com](https://entra.microsoft.com/)**
13. これにより、**Microsoft Entra 管理センター**が開きます。左側のナビゲーション ウィンドウで、 [**さらに表示]をクリックして、** **[ハイブリッド管理]**の下の**[Azure AD Connect]**を選択します。
14. AAD Connectについて**| [開始]**ページの中央のナビゲーション ウィンドウで、**[同期の接続]**を選択します。
15. AAD Connectについて**| [同期の接続]**ページの右側の詳細ペインの [**ユーザー サインイン]セクションで、****パススルー認証**のステータスが [**有効] で**あることを確認し、**[パススルー認証]**を選択します。
16. **[パススルー認証]**ページで、パススルー認証エージェントがインストールされているサーバーのリストを確認します。これにより、**LON-DC1.Adatum.com**が表示されるはずです。
17. **[パススルー認証]**ページの右上隅にある[ **X]**を選択してページを閉じ、同じ操作を行って [ **AAD Connect | AAD Connect] ページを閉じます。****Sync**ページと**Adatum Corporation |を接続します。****概要**ページ。**Microsoft Entra 管理センター**に戻っているはずです。
18. **Microsoft Entra 管理センターは**次のタスクで使用するため、開いたままにしておきます。

### [タスク 2: Azure AD スマート ロックアウトを展開する](https://github.com/MicrosoftLearning/MS-102T00-Microsoft-365-Administrator-Essentials/blob/master/Instructions/Labs/LAB_AK_03_Lab3_Ex3_Manage_secure_user_access.md#task-2-deploy-azure-ad-smart-lockout)

Adatum の CTO は、ユーザーのパスワードを推測したり、ネットワークへの侵入を許可するためにブルート フォース手法を使用したりしようとする悪意のある攻撃者をロックアウトするのに役立つ Azure AD Smart Lockout を展開するようあなたに依頼しました。Smart Lockout は、有効なユーザーからのサインインを認識し、攻撃者やその他の不明なソースからのサインインとは異なる方法で処理します。

CTO は、Adatum のユーザーが自分のアカウントにアクセスし続けて生産性を維持できる一方で、攻撃者をロックアウトできるため、Smart Lockout の実装に熱心です。CTO は、ユーザーが同じパスワードを複数回使用できないように、また、単純すぎるまたは一般的すぎると考えられるパスワードを使用できないように Smart Lockout を構成するようホリーに依頼しました。

1. LON-DC1 で、タスクバーの**サーバー マネージャーアイコンが既に開いている場合は選択します。**それ以外の場合は、今すぐ開きます。

2. **サーバー マネージャー**で、右上のメニュー バーで [**ツール]を選択し、ドロップダウン メニューで****[グループ ポリシー管理] を選択します。**

3. **グループポリシー管理**ウィンドウを最大化します。

4. 組織のアカウント ロックアウト ポリシーを含むグループ ポリシーを編集したいと考えています。必要に応じて、左側のペインのルート コンソール ツリーで、**Forest:Adatum.com**を展開し、次に**Domains**、**Adatum.com**の順に展開します。

   **Adatum.com**で、 **[デフォルト ドメイン ポリシー]**を右クリックし、メニューから**[編集]を選択します。**

5. **表示されるグループ ポリシー管理エディター**ウィンドウを最大化します。

6. 左側のペインの**[デフォルト ドメイン ポリシー]**ツリーの**[コンピュータの構成]で、** **[ポリシー]**、**[Windows の設定]**、**[セキュリティの設定]**、**[アカウント ポリシー]**の順に展開します。

7. **[アカウント ポリシー]**フォルダーで、**[アカウント ロックアウト ポリシー]**を選択します。

8. 右側のペインにあるように、スマート ロックアウト パラメーターはいずれも定義されていません。**Microsoft Entra 管理センター**を使用して、Entra ID コンテキストに対応する値を割り当てます。

9. タスク バーで Edge ブラウザー アイコンを選択します。これにより、**Microsoft Entra 管理センターが**表示されます。

10. **Microsoft Entra 管理センター**の左側のナビゲーション ウィンドウで、**[保護]**サブメニューの**[認証方法]**を選択します。

11. 認証方法**| 「ポリシー」ページの****「管理」**セクションの下の中央ペインで、**「パスワード保護」を選択します。**

12. 認証方法**| パスワード保護**ウィンドウの右側の詳細ペインに、次の情報を入力します。

    - **[カスタム スマート ロックアウト]**セクション:
      - **ロックアウトしきい値:**このフィールドは、最初のロックアウトまでにアカウントで許可されるサインイン失敗の回数を示します。デフォルトは 10 です。テスト目的で、Adatum はこれを**3**に設定するように要求しました。
      - **ロックアウト期間 (秒):**これは、各ロックアウトの長さ (秒) です。デフォルトは 60 秒 (1 分) です。**Adatum は、これを90**秒に変更するようリクエストしました。
    - **「カスタム禁止パスワード」**セクション:
      - **カスタム リストを強制する**: **[はい]を選択します。**
      - **カスタム禁止パスワード リスト:**次の値を入力します (各値が別の行に表示されるように、各値を入力した後に Enter キーを押します)。
        - **パスワード01**
        - **F00tball01**
        - **Se@Hawks1**
        - **ネバーフォーゲット!!**
    - **「モード」**セクションで、**「強制」を選択します。**

13. ページ上部のメニュー バーで**[保存]**を選択します。

14. 次に、禁止されたパスワードの機能をテストする必要があります。画面の右上隅にある Holly Dickson のユーザー アイコンを選択し、表示されるメニューで [**パスワードの変更]**を選択します。

15. 新しいタブが開き、**「パスワードの変更」**ウィンドウが表示されます。**[古いパスワード]**フィールドに、Holly の既存のパスワードを入力します。これは、ラボ ホスティング プロバイダーからテナント管理者アカウント (つまり、MOD 管理者アカウント) 用に提供される**Microsoft 365 テナント パスワード**と同じです。

    Never4getに参加してください**!!** **[新しいパスワードの作成] フィールド**と**[新しいパスワードの確認]**フィールドに入力し、**[送信]**を選択します。表示されるエラー メッセージに注目してください。

16. ブラウザで、**[パスワードの変更]**タブを閉じます。

17. 次に、ロックアウトしきい値機能をテストする必要があります。**[認証方法 - Azure Active Directory 管理センター]**タブで、画面の右上隅にある Holly Dickson のユーザー アイコンを選択し、表示されるメニューで [**サインアウト]**を選択します。

18. Holly としてサインアウトすると、**[Microsoft Azure へのサインイン]**タブに**[アカウントの選択]**ウィンドウが表示されます。あるユーザーとして Microsoft オンライン サービスからサインアウトし、別のユーザーとしてサインインし直すときのベスト プラクティスとして、[**サインアウト]**タブまたは**[サインイン]**タブを除くすべてのブラウザー タブを閉じます。この場合は、他のタブを閉じて、**[サインイン]**タブを開いたままにしてください。

    **[アカウントの選択]**ウィンドウで、**[別のアカウントを使用する]**を選択します。

19. **[サインイン]**ウィンドウに**[「laura@xxxxxZZZZZZ.onmicrosoft.com」](mailto:laura@xxxxxZZZZZZ.onmicrosoft.com)**と入力し(xxxxxZZZZZZ は、ラボ ホスティング プロバイダーによって割り当てられたテナント プレフィックスです)、 [**次へ]**を選択します。

20. **[パスワードの入力]**ウィンドウで、ランダムに組み合わせた文字を入力し、**[サインイン]**を選択します。無効なパスワードのエラー メッセージが表示されることに注意してください。

    この手順をさらに 2 回繰り返します。

    **ロックアウトしきい値を****3**に設定したため、3 回目のサインイン試行の失敗後にアカウントがロックされていることを示すエラー メッセージが表示されます。

    **ユーザー:** 3 回目の試行後にこのロックアウト メッセージを受信しない場合、システムはこのロックアウトしきい値の変更をサービス全体に伝達することをまだ完了していません。変更が有効になるまでに数分かかる場合があります。数分待ってから、偽のパスワードを使用して再度サインインします。このラボのテストではさまざまな結果が得られました。場合によっては、変更がほぼ即座に反映され、3 回目のサインイン試行後にロックアウトされることがあります。また、ロックアウト メッセージが表示されるまでに 5 ～ 10 分かかる場合もありました。ロックアウト メッセージを受信するまでこのプロセスを続けます。ロックアウト メッセージを受信すると、不正アクセスを防ぐために Laura のアカウントが一時的にロックされます。

21. 前に設定した**90 秒のロックアウト期間**が経過するまで、Laura として再ログインすることは禁止されます。

    **[ロックアウトされたら、90 秒待ってから、 laura@xxxxxZZZZZZ.onmicrosoft.com](mailto:laura@xxxxxZZZZZZ.onmicrosoft.com)**としてサインインし直します(xxxxxZZZZZZ は、ラボ ホスティング プロバイダーによって割り当てられたテナント プレフィックスです)。**[パスワード]**フィールドに、Laura のパスワードを入力します。これは、ラボ ホスティング プロバイダーからテナント管理者アカウント (つまり、MOD 管理者アカウント) 用に提供される**Microsoft 365 テナント パスワード**と同じです。Laura として正常にサインインできることを確認します。

22. ログインが成功したら、開いているアプリケーションをすべて閉じることができます。これは、LON-DC1 ドメイン コントローラーを使用した最後の実習となります。

# [ラボ 3 の終了](https://github.com/MicrosoftLearning/MS-102T00-Microsoft-365-Administrator-Essentials/blob/master/Instructions/Labs/LAB_AK_03_Lab3_Ex3_Manage_secure_user_access.md#end-of-lab-3)
